<!doctype html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <title>Scavenger Hunt Generator</title>
    <meta name="description" content="">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">

    <style>
        html,
        body,
        #map-canvas {
            height: 1000px;
            margin: 0px;
            padding: 0px;
            position: relative;
            z-index: -1;
        }
        h1 {
            padding: 10px;
        }
        h2 {
            font-family: Georgia;
            font-size: 15px;
        }
        #search {
          -webkit-border-radius: 60;
          -moz-border-radius: 60;
          border-radius: 40px;
          font-family: Georgia;
          color: #ffffff;
          font-size: 15px;
          background: #0099ff;
          padding: 2px 6px 2px 6px;
          text-decoration: none;
          position: absolute;
        }
        #search:hover {
          background: #9eb0ff;
          text-decoration: none;
        }
        #city {
            width: 300px;
            height: 30px;
            font-size: 15px;
            font-family: Georgia;
        }
        .container {
            padding: 60px 20px;
            position: absolute;
        }
        .coins {
            height: 20px;
            width: 225px;
            padding: 0px 10px 20px 10px;
            position: absolute;
            font-family: '8BITWONDERNominal';
            font-size: 12px;
            text-align: left;
            display: inline-block;
            background-color: orange;
            margin: 20px auto auto 1150px;
            border-style: ridge;
            background: #fceabb; /* Old browsers */
            background: -moz-linear-gradient(top, #fceabb 0%, #fccd4d 51%, #f8b500 54%, #fbdf93 100%); /* FF3.6-15 */
            background: -webkit-linear-gradient(top, #fceabb 0%,#fccd4d 51%,#f8b500 54%,#fbdf93 100%); /* Chrome10-25,Safari5.1-6 */
            background: linear-gradient(to bottom, #fceabb 0%,#fccd4d 51%,#f8b500 54%,#fbdf93 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
            filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fceabb', endColorstr='#fbdf93',GradientType=0 ); /* IE6-9 */
        }
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.2.min.js"></script>

</head>

<body>
    <div class="container">
        <section id="fetch">
            <input type="text" placeholder="Enter a city name to start earning coins!" id="city" />
            <button id="search">Search</button>
        </section>
        <section id="input">
        </section>
    </div>
    <script>
        $(document).ready(function() {
            $('#city').focus(function() {
                var full = $("#input").has("img").length ? true : false;
                if (full == false) {
                    $('#input').empty();
                }
            });

            var getCity = function() {
                var city_name = $('#city').val();
                if (city_name == '') {
                    $('#input').html("<div class='loading'>Please enter something.</div>");
                } else {
                    $('#input').html("<div class='loading'>Here are cool places to explore!</div>");
                    var queryBuilder = "https://api.sandbox.amadeus.com/v1.2/points-of-interest/yapq-search-text?apikey=MdRDIiKITombYOZ8WNpCnXizyYmb2QIG&city_name=" + city_name;
              $.getJSON(queryBuilder, function(json) {
                var image = 'https://raw.githubusercontent.com/prathyushasai/GoGo-Places/master/coin.png';
                var markers = [];
                var infoWindows = [];
                for (i = 0; i < 8; ++ i) {
                  var myLatLng = {lat: json.points_of_interest[i].location.latitude, lng: json.points_of_interest[i].location.longitude};
                  var contentString = '<div id="content">'+
                    '<div id="siteNotice">'+'</div>'+
                    '<h1 id="firstHeading" class="firstHeading">'+ json.points_of_interest[i].title + '</h1>'+
                    '<span id="bodyContent">'+ json.points_of_interest[i].details.short_description + '<p>Points: ' + json.points_of_interest[i].grades.yapq_grade + '</p>'+ '</span>'+
                    '<span id="img"><a href="Picture">'+
                    json.points_of_interest[i].main_image + '</a> </span> </div>';
                  var infoWindow = new google.maps.InfoWindow({
                      content: contentString
                  });
                  var map_marker = new google.maps.Marker({
                      position: myLatLng,
                      map: map,
                      draggable: true,
                      animation: google.maps.Animation.DROP,
                      infoWindowIndex: i,
                      icon: image
                  });
                  map_marker.setMap(map);
                  google.maps.event.addListener(map_marker, 'click', function(event) {
                      map.panTo(event.latLng);
                      infoWindows[this.infoWindowIndex].open(map, this);
                    });
                  infoWindows.push(infoWindow);
                  markers.push(map_marker);
                  }
                  });
            }
          return false;
     }
   $('#search').click(getCity);
   $('#city').keyup(function(event){
       if(event.keyCode == 13){
           getCity();
       }
   });

});
    </script>

    <div id="poster"></div>
    <div id="map-canvas"></div>

    <!-- Map Configuration and data -->
    <script>
        var map;
        var map_marker;
        var lat = null;
        var lng = null;
        var lineCoordinatesArray = [];

        // sets your location as default
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                    var locationMarker = null;
                    if (locationMarker) {
                        // return if there is a locationMarker bug
                        return;
                    }
                    lat = position.coords["latitude"];
                    lng = position.coords["longitude"];

                    // initialize google maps
                    google.maps.event.addDomListener(window, 'load', initialize());
                },
                function(error) {
                    console.log("Error: ", error);
                }, {
                    enableHighAccuracy: true
                }
            );
        }

        function initialize() {
            console.log("Google Maps Initialized")
            map = new google.maps.Map(document.getElementById('map-canvas'), {
                zoom: 15,
                center: {
                    lat: lat,
                    lng: lng,
                    alt: 0
                }
            });

            map_marker = new google.maps.Marker({
                position: {
                    lat: lat,
                    lng: lng
                },
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP
            });
            map_marker.setMap(map);
            map_marker.addListener('click', toggleBounce);
        }

        // moves the marker and center of map
        function redraw() {
            map.setCenter({
                lat: lat,
                lng: lng,
                alt: 0
            })
            map_marker.setPosition({
                lat: lat,
                lng: lng,
                alt: 0,
                draggable: true,
                animation: google.maps.Animation.DROP
            });
            map_marker.addListener('click', toggleBounce);
            pushCoordToArray(lat, lng);

            var lineCoordinatesPath = new google.maps.Polyline({
                path: lineCoordinatesArray,
                geodesic: true,
                strokeColor: '#2E10FF',
                strokeOpacity: 1.0,
                strokeWeight: 2
            });

            lineCoordinatesPath.setMap(map);
        }

        function pushCoordToArray(latIn, lngIn) {
            lineCoordinatesArray.push(new google.maps.LatLng(latIn, lngIn));
        }

        function toggleBounce() {
          if (map_marker.getAnimation() !== null) {
            map_marker.setAnimation(null);
          } else {
            map_marker.setAnimation(google.maps.Animation.BOUNCE);
          }
        }

        function AutoCenter() {
        var bounds = new google.maps.LatLngBounds();
        $.each(markers, function (index, marker) {
        bounds.extend(marker.position);
        });
        map.fitBounds(bounds);
        }
    </script>
</body>

</html>
