<!doctype html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <title>Scavenger Hunt Generator</title>
    <meta name="description" content="">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">

    <style>
        html,
        body,
        #map-canvas {
            height: 1000px;
            margin: 0px;
            padding: 0px;
            position: relative;
        }
        h1 {
            padding: 10px;
        }
        #search {
          -webkit-border-radius: 60;
          -moz-border-radius: 60;
          border-radius: 40px;
          font-family: Georgia;
          color: #ffffff;
          font-size: 15px;
          background: #0099ff;
          padding: 2px 6px 2px 6px;
          text-decoration: none;
          position: absolute;
        }
        #search:hover {
          background: #9eb0ff;
          text-decoration: none;
        }
        #fetch {
            padding: 10px;
            position: absolute;
        }
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.2.min.js"></script>


</head>

<body>
    <div class="container">
        <section id="fetch">
            <input type="text" placeholder="Enter a city name" id="city" />
            <button id="search">Search</button>
        </section>
        <section id="input">
        </section>
    </div>
    <script>
        $(document).ready(function() {
            $('#city').focus(function() {
                var full = $("#input").has("img").length ? true : false;
                if (full == false) {
                    $('#input').empty();
                }
            });

            var getCity = function() {
                var city_name = $('#city').val();
                if (city_name == '') {
                    $('#input').html("<h2 class='loading'>Please enter something.</h2>");
                } else {
                    $('#input').html("<h2 class='loading'>Here are cool places to explore!</h2>");
                    var queryBuilder = "https://api.sandbox.amadeus.com/v1.2/points-of-interest/yapq-search-text?apikey=MdRDIiKITombYOZ8WNpCnXizyYmb2QIG&city_name=" + city_name;
              $.getJSON(queryBuilder, function(json) {
                console.log(json)
                for (i = 0; i < 8; ++ i) {
                  var myLatLng = {lat: json.points_of_interest[i].location.latitude, lng: json.points_of_interest[i].location.longitude};
                  var map_marker = new google.maps.Marker({
                      position: myLatLng,
                      map: map,
                      title: json.points_of_interest[i].title
                  });
                  map_marker.setMap(map);
                }
               });

            }
          return false;
     }

   $('#search').click(getCity);
   $('#city').keyup(function(event){
       if(event.keyCode == 13){
           getCity();
       }
   });

});
    </script>

    <div id="poster"></div>
    <div id="map-canvas"></div>

    <!-- Map Configuration and data -->
    <script>
        var map;
        var map_marker;
        var lat = null;
        var lng = null;
        var lineCoordinatesArray = [];

        // sets your location as default
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                    var locationMarker = null;
                    if (locationMarker) {
                        // return if there is a locationMarker bug
                        return;
                    }
                    lat = position.coords["latitude"];
                    lng = position.coords["longitude"];

                    // initialize google maps
                    google.maps.event.addDomListener(window, 'load', initialize());
                },
                function(error) {
                    console.log("Error: ", error);
                }, {
                    enableHighAccuracy: true
                }
            );
        }


        function initialize() {
            console.log("Google Maps Initialized")
            map = new google.maps.Map(document.getElementById('map-canvas'), {
                zoom: 15,
                center: {
                    lat: lat,
                    lng: lng,
                    alt: 0
                }
            });

            map_marker = new google.maps.Marker({
                position: {
                    lat: lat,
                    lng: lng
                },
                map: map
            });
            map_marker.setMap(map);
        }

        // moves the marker and center of map
        function redraw() {
            map.setCenter({
                lat: lat,
                lng: lng,
                alt: 0
            })
            map_marker.setPosition({
                lat: lat,
                lng: lng,
                alt: 0
            });
            pushCoordToArray(lat, lng);

            var lineCoordinatesPath = new google.maps.Polyline({
                path: lineCoordinatesArray,
                geodesic: true,
                strokeColor: '#2E10FF',
                strokeOpacity: 1.0,
                strokeWeight: 2
            });

            lineCoordinatesPath.setMap(map);
        }

        function pushCoordToArray(latIn, lngIn) {
            lineCoordinatesArray.push(new google.maps.LatLng(latIn, lngIn));
        }
    </script>
</body>

</html>
